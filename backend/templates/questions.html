<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Application</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        #question-container { margin-bottom: 20px; }
        #options-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { padding: 10px; cursor: pointer; }
        #result { margin-top: 20px; font-weight: bold; }
        #score-container { font-size: 18px; font-weight: bold; margin-bottom: 20px; }
        #start-form { margin-bottom: 20px; }
        #report-button { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Quiz Application</h1>

    <!-- Start Quiz Form -->
    <div id="start-form">
        <h2>Start Quiz</h2>
        <label for="subject">Subject:</label>
        <input type="text" id="subject" name="subject" required>
        <br>
        <label for="hardness_level">Hardness Level (1-10):</label>
        <input type="number" id="hardness_level" name="hardness_level" min="1" max="10" required>
        <br>
        <label for="num_questions">Number of Questions:</label>
        <input type="number" id="num_questions" name="num_questions" min="1" required>
        <br>
        <button id="start-button">Start Quiz</button>
    </div>

    <div id="score-container" style="display: none;">Score: <span id="score">0</span></div>
    <div id="question-container"></div>
    <div id="options-container"></div>
    <div id="result"></div>
    <button id="next-button" style="display: none;">Next Question</button>
    <button id="report-button" style="display: none;" onclick="goToReport()">Go to Report</button>

    <script>
        document.getElementById('start-button').onclick = () => {
            const subject = document.getElementById('subject').value;
            const hardness_level = document.getElementById('hardness_level').value;
            const num_questions = document.getElementById('num_questions').value;

            fetch('/start_quiz', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    subject: subject,
                    hardness_level: parseInt(hardness_level),
                    num_questions: parseInt(num_questions)
                }),
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('start-form').style.display = 'none';
                document.getElementById('score-container').style.display = 'block';
                document.getElementById('report-button').style.display = 'block';  // Show the report button
                loadQuestion();  // Start loading questions after the quiz starts
            });
        };

        function updateScore(score) {
            document.getElementById('score').textContent = score;
        }

        function loadQuestion() {
            fetch('/get_question')
                .then(response => response.json())
                .then(data => {
                    if (data.redirect) {
                        window.location.href = data.redirect;  // Redirect to the report page
                        return;
                    }
                    document.getElementById('question-container').innerHTML = `<h2>${data.question}</h2>`;
                    const optionsContainer = document.getElementById('options-container');
                    optionsContainer.innerHTML = '';
                    data.options.forEach(option => {
                        const button = document.createElement('button');
                        button.textContent = option.slice(3);  // Remove the A), B), etc.
                        button.onclick = () => checkAnswer(option[0]);  // Use A, B, C, D as the answer
                        optionsContainer.appendChild(button);
                    });
                    document.getElementById('result').innerHTML = '';
                    document.getElementById('next-button').style.display = 'none';
                });
        }

        function checkAnswer(answer) {
            fetch('/check_answer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    answer: answer
                }),
            })
            .then(response => response.json())
            .then(data => {
                const resultElement = document.getElementById('result');
                if (data.correct) {
                    resultElement.innerHTML = 'Correct!';
                    resultElement.style.color = 'green';
                } else {
                    resultElement.innerHTML = `Incorrect. The correct answer is: ${data.correct_answer}`;
                    resultElement.style.color = 'red';
                }
                document.getElementById('next-button').style.display = 'block';
                updateScore(data.score);  // Update the score display
            });
        }

        document.getElementById('next-button').onclick = loadQuestion;

        function goToReport() {
            window.location.href = '/report';  // Redirect to the report page
        }

        // Optionally, load the first question when the page loads if the quiz is started
    </script>
</body>
</html>